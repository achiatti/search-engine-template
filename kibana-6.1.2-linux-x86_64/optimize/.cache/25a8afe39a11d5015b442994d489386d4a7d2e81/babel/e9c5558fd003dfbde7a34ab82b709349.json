{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/ui/public/filter_bar/filter_bar.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/ui/public/filter_bar/filter_bar.js","mtime":1515552035000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.toggleFilterDisabled = exports.enableFilter = exports.disableFilter = undefined;\n\nvar _disable_filter = require('./lib/disable_filter');\n\nObject.defineProperty(exports, 'disableFilter', {\n  enumerable: true,\n  get: function get() {\n    return _disable_filter.disableFilter;\n  }\n});\nObject.defineProperty(exports, 'enableFilter', {\n  enumerable: true,\n  get: function get() {\n    return _disable_filter.enableFilter;\n  }\n});\nObject.defineProperty(exports, 'toggleFilterDisabled', {\n  enumerable: true,\n  get: function get() {\n    return _disable_filter.toggleFilterDisabled;\n  }\n});\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _filter_bar = require('ui/filter_bar/filter_bar.html');\n\nvar _filter_bar2 = _interopRequireDefault(_filter_bar);\n\nrequire('ui/directives/json_input');\n\nrequire('../filter_editor');\n\nrequire('./filter_pill/filter_pill');\n\nvar _filter_applied_and_unwrap = require('ui/filter_bar/lib/filter_applied_and_unwrap');\n\nvar _map_and_flatten_filters = require('ui/filter_bar/lib/map_and_flatten_filters');\n\nvar _map_flatten_and_wrap_filters = require('ui/filter_bar/lib/map_flatten_and_wrap_filters');\n\nvar _extract_time_filter = require('ui/filter_bar/lib/extract_time_filter');\n\nvar _filter_out_time_based_filter = require('ui/filter_bar/lib/filter_out_time_based_filter');\n\nvar _change_time_filter = require('ui/filter_bar/lib/change_time_filter');\n\nvar _query_filter = require('ui/filter_bar/query_filter');\n\nvar _compare_filters = require('./lib/compare_filters');\n\nvar _modules = require('ui/modules');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _module = _modules.uiModules.get('kibana');\n\n_module.directive('filterBar', function (Private, Promise, getAppState) {\n  var mapAndFlattenFilters = Private(_map_and_flatten_filters.FilterBarLibMapAndFlattenFiltersProvider);\n  var mapFlattenAndWrapFilters = Private(_map_flatten_and_wrap_filters.FilterBarLibMapFlattenAndWrapFiltersProvider);\n  var extractTimeFilter = Private(_extract_time_filter.FilterBarLibExtractTimeFilterProvider);\n  var filterOutTimeBasedFilter = Private(_filter_out_time_based_filter.FilterBarLibFilterOutTimeBasedFilterProvider);\n  var changeTimeFilter = Private(_change_time_filter.FilterBarLibChangeTimeFilterProvider);\n  var queryFilter = Private(_query_filter.FilterBarQueryFilterProvider);\n\n  return {\n    template: _filter_bar2.default,\n    restrict: 'E',\n    scope: {\n      indexPatterns: '='\n    },\n    link: function link($scope) {\n      // bind query filter actions to the scope\n      ['addFilters', 'toggleFilter', 'toggleAll', 'pinFilter', 'pinAll', 'invertFilter', 'invertAll', 'removeFilter', 'removeAll'].forEach(function (method) {\n        $scope[method] = queryFilter[method];\n      });\n\n      $scope.state = getAppState();\n\n      $scope.showAddFilterButton = function () {\n        return _lodash2.default.compact($scope.indexPatterns).length > 0;\n      };\n\n      $scope.applyFilters = function (filters) {\n        addAndInvertFilters((0, _filter_applied_and_unwrap.filterAppliedAndUnwrap)(filters));\n        $scope.newFilters = [];\n\n        // change time filter\n        if ($scope.changeTimeFilter && $scope.changeTimeFilter.meta && $scope.changeTimeFilter.meta.apply) {\n          changeTimeFilter($scope.changeTimeFilter);\n        }\n      };\n\n      $scope.addFilter = function () {\n        $scope.editingFilter = {\n          meta: { isNew: true }\n        };\n      };\n\n      $scope.deleteFilter = function (filter) {\n        $scope.removeFilter(filter);\n        if (filter === $scope.editingFilter) $scope.cancelEdit();\n      };\n\n      $scope.editFilter = function (filter) {\n        $scope.editingFilter = filter;\n      };\n\n      $scope.cancelEdit = function () {\n        delete $scope.editingFilter;\n      };\n\n      $scope.saveEdit = function (filter, newFilter, isPinned) {\n        if (!filter.meta.isNew) $scope.removeFilter(filter);\n        delete $scope.editingFilter;\n        $scope.addFilters([newFilter], isPinned);\n      };\n\n      $scope.clearFilterBar = function () {\n        $scope.newFilters = [];\n        $scope.changeTimeFilter = null;\n      };\n\n      // update the scope filter list on filter changes\n      $scope.$listen(queryFilter, 'update', function () {\n        updateFilters();\n      });\n\n      // when appState changes, update scope's state\n      $scope.$watch(getAppState, function (appState) {\n        $scope.state = appState;\n      });\n\n      $scope.$watch('state.$newFilters', function (filters) {\n        if (!filters) return;\n\n        // If filters is not undefined and the length is greater than\n        // one we need to set the newFilters attribute and allow the\n        // users to decide what they want to apply.\n        if (filters.length > 1) {\n          return mapFlattenAndWrapFilters(filters).then(function (results) {\n            extractTimeFilter(results).then(function (filter) {\n              $scope.changeTimeFilter = filter;\n            });\n            return results;\n          }).then(filterOutTimeBasedFilter).then(function (results) {\n            $scope.newFilters = results;\n          });\n        }\n\n        // Just add single filters to the state.\n        if (filters.length === 1) {\n          Promise.resolve(filters).then(function (filters) {\n            extractTimeFilter(filters).then(function (timeFilter) {\n              if (timeFilter) changeTimeFilter(timeFilter);\n            });\n            return filters;\n          }).then(filterOutTimeBasedFilter).then(addAndInvertFilters);\n        }\n      });\n\n      function addAndInvertFilters(filters) {\n        var existingFilters = queryFilter.getFilters();\n        var inversionFilters = _lodash2.default.filter(existingFilters, function (existingFilter) {\n          var newMatchingFilter = _lodash2.default.find(filters, _lodash2.default.partial(_compare_filters.compareFilters, existingFilter));\n          return newMatchingFilter && newMatchingFilter.meta && existingFilter.meta && existingFilter.meta.negate !== newMatchingFilter.meta.negate;\n        });\n        var newFilters = _lodash2.default.reject(filters, function (filter) {\n          return _lodash2.default.find(inversionFilters, _lodash2.default.partial(_compare_filters.compareFilters, filter));\n        });\n\n        _lodash2.default.forEach(inversionFilters, $scope.invertFilter);\n        $scope.addFilters(newFilters);\n      }\n\n      function updateFilters() {\n        var filters = queryFilter.getFilters();\n        mapAndFlattenFilters(filters).then(function (results) {\n          // used to display the current filters in the state\n          $scope.filters = _lodash2.default.sortBy(results, function (filter) {\n            return !filter.meta.pinned;\n          });\n          $scope.$emit('filterbar:updated');\n        });\n      }\n\n      updateFilters();\n    }\n  };\n});",null]}