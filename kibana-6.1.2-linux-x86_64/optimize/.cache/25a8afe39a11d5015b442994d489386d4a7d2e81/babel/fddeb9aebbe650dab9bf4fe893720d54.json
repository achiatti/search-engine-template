{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/core_plugins/timelion/public/directives/timelion_help/timelion_help.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/core_plugins/timelion/public/directives/timelion_help/timelion_help.js","mtime":1515552031000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nvar _timelion_help = require('./timelion_help.html');\n\nvar _timelion_help2 = _interopRequireDefault(_timelion_help);\n\nvar _modules = require('ui/modules');\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar app = _modules.uiModules.get('apps/timelion', []);\n\napp.directive('timelionHelp', function ($http) {\n  return {\n    restrict: 'E',\n    template: _timelion_help2.default,\n    controller: function controller($scope) {\n      $scope.functions = {\n        list: [],\n        details: null\n      };\n\n      function init() {\n        $scope.es = {\n          invalidCount: 0\n        };\n        getFunctions();\n        checkElasticsearch();\n      }\n\n      function getFunctions() {\n        return $http.get('../api/timelion/functions').then(function (resp) {\n          $scope.functions.list = resp.data;\n        });\n      }\n      $scope.recheckElasticsearch = function () {\n        $scope.es.valid = null;\n        checkElasticsearch().then(function (valid) {\n          if (!valid) $scope.es.invalidCount++;\n        });\n      };\n\n      function checkElasticsearch() {\n        return $http.get('../api/timelion/validate/es').then(function (resp) {\n          if (resp.data.ok) {\n\n            $scope.es.valid = true;\n            $scope.es.stats = {\n              min: (0, _moment2.default)(resp.data.min).format('LLL'),\n              max: (0, _moment2.default)(resp.data.max).format('LLL'),\n              field: resp.data.field\n            };\n          } else {\n            $scope.es.valid = false;\n            $scope.es.invalidReason = function () {\n              try {\n                var esResp = JSON.parse(resp.data.resp.response);\n                return _lodash2.default.get(esResp, 'error.root_cause[0].reason');\n              } catch (e) {\n                if (_lodash2.default.get(resp, 'data.resp.message')) return _lodash2.default.get(resp, 'data.resp.message');\n                if (_lodash2.default.get(resp, 'data.resp.output.payload.message')) return _lodash2.default.get(resp, 'data.resp.output.payload.message');\n                return 'Unknown error';\n              }\n            }();\n          }\n          return $scope.es.valid;\n        });\n      }\n      init();\n    }\n  };\n});",null]}