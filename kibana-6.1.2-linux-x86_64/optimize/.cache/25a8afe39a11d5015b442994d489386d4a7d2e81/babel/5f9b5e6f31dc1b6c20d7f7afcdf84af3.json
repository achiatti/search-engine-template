{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/ui/public/filter_editor/filter_editor.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/ui/public/filter_editor/filter_editor.js","mtime":1515552036000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _modules = require('ui/modules');\n\nvar _compat = require('ui/compat');\n\nvar _filter_operators = require('./lib/filter_operators');\n\nvar _filter_editor = require('./filter_editor.html');\n\nvar _filter_editor2 = _interopRequireDefault(_filter_editor);\n\nrequire('../directives/documentation_href');\n\nrequire('./filter_query_dsl_editor');\n\nrequire('./filter_field_select');\n\nrequire('./filter_operator_select');\n\nrequire('./params_editor/filter_params_editor');\n\nrequire('./filter_editor.less');\n\nvar _filter_editor_utils = require('./lib/filter_editor_utils');\n\nvar _lib = require('../filter_manager/lib');\n\nvar filterBuilder = _interopRequireWildcard(_lib);\n\nvar _key_map = require('../utils/key_map');\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _module = _modules.uiModules.get('kibana');\n_module.directive('filterEditor', function ($timeout, indexPatterns) {\n  return {\n    restrict: 'E',\n    template: _filter_editor2.default,\n    scope: {\n      indexPatterns: '=',\n      filter: '=',\n      onDelete: '&',\n      onCancel: '&',\n      onSave: '&'\n    },\n    controllerAs: 'filterEditor',\n    bindToController: true,\n    controller: (0, _compat.callAfterBindingsWorkaround)(function ($scope, $element) {\n      var _this = this;\n\n      this.init = function () {\n        var filter = _this.filter;\n\n        _this.alias = filter.meta.alias;\n        _this.isEditingQueryDsl = false;\n        _this.queryDsl = (0, _filter_editor_utils.getQueryDslFromFilter)(filter);\n        if (filter.meta.isNew) {\n          _this.setFocus('field');\n        } else {\n          (0, _filter_editor_utils.getFieldFromFilter)(filter, indexPatterns).then(function (field) {\n            _this.setField(field);\n            _this.setOperator((0, _filter_editor_utils.getOperatorFromFilter)(filter));\n            _this.params = (0, _filter_editor_utils.getParamsFromFilter)(filter);\n          });\n        }\n      };\n\n      $scope.$watch(function () {\n        return _this.filter;\n      }, this.init);\n      $scope.$watchCollection(function () {\n        return _this.filter.meta;\n      }, this.init);\n\n      this.setQueryDsl = function (queryDsl) {\n        _this.queryDsl = queryDsl;\n      };\n\n      this.setField = function (field) {\n        _this.field = field;\n        _this.operator = null;\n        _this.params = {};\n      };\n\n      this.onFieldSelect = function (field) {\n        _this.setField(field);\n        _this.setFocus('operator');\n      };\n\n      this.setOperator = function (operator) {\n        _this.operator = operator;\n      };\n\n      this.onOperatorSelect = function (operator) {\n        _this.setOperator(operator);\n        _this.setFocus('params');\n      };\n\n      this.setParams = function (params) {\n        _this.params = params;\n      };\n\n      this.setFocus = function (name) {\n        $timeout(function () {\n          return $scope.$broadcast('focus-' + name);\n        });\n      };\n\n      this.toggleEditingQueryDsl = function () {\n        _this.isEditingQueryDsl = !_this.isEditingQueryDsl;\n      };\n\n      this.isQueryDslEditorVisible = function () {\n        var _filter$meta = _this.filter.meta,\n            type = _filter$meta.type,\n            isNew = _filter$meta.isNew;\n\n        return _this.isEditingQueryDsl || !isNew && !_filter_operators.FILTER_OPERATOR_TYPES.includes(type);\n      };\n\n      this.isValid = function () {\n        if (_this.isQueryDslEditorVisible()) {\n          return _lodash2.default.isObject(_this.queryDsl);\n        }\n        var field = _this.field,\n            operator = _this.operator,\n            params = _this.params;\n\n        return (0, _filter_editor_utils.isFilterValid)({ field: field, operator: operator, params: params });\n      };\n\n      this.save = function () {\n        var filter = _this.filter,\n            field = _this.field,\n            operator = _this.operator,\n            params = _this.params,\n            alias = _this.alias;\n\n\n        var newFilter = void 0;\n        if (_this.isQueryDslEditorVisible()) {\n          var meta = _lodash2.default.pick(filter.meta, ['negate', 'index']);\n          meta.index = meta.index || _this.indexPatterns[0].id;\n          newFilter = Object.assign(_this.queryDsl, { meta: meta });\n        } else {\n          var indexPattern = field.indexPattern;\n          newFilter = (0, _filter_editor_utils.buildFilter)({ indexPattern: indexPattern, field: field, operator: operator, params: params, filterBuilder: filterBuilder });\n        }\n        newFilter.meta.disabled = filter.meta.disabled;\n        newFilter.meta.alias = alias;\n\n        var isPinned = _lodash2.default.get(filter, ['$state', 'store']) === 'globalState';\n        return _this.onSave({ filter: filter, newFilter: newFilter, isPinned: isPinned });\n      };\n\n      $element.on('keydown', function (event) {\n        if (_key_map.keyMap[event.keyCode] === 'escape') {\n          $timeout(function () {\n            return _this.onCancel();\n          });\n        }\n      });\n    })\n  };\n});",null]}