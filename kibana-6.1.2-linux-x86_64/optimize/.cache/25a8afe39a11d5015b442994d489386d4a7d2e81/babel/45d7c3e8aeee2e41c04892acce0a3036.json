{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/ui/public/agg_types/metrics/lib/parent_pipeline_agg_controller.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/ui/public/agg_types/metrics/lib/parent_pipeline_agg_controller.js","mtime":1515552034000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parentPipelineAggController = undefined;\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _safe_make_label = require('./safe_make_label');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar parentPipelineAggController = function parentPipelineAggController($scope) {\n\n  $scope.safeMakeLabel = _safe_make_label.safeMakeLabel;\n\n  $scope.$watch('responseValueAggs', updateOrderAgg);\n  $scope.$watch('agg.params.metricAgg', updateOrderAgg);\n\n  $scope.$on('$destroy', function () {\n    var lastBucket = _lodash2.default.findLast($scope.vis.getAggConfig(), function (agg) {\n      return agg.schema.group === 'buckets';\n    });\n    if ($scope.aggForm && $scope.aggForm.agg) {\n      $scope.aggForm.agg.$setValidity('bucket', true);\n    }\n    if (lastBucket && lastBucket.error) {\n      delete lastBucket.error;\n    }\n  });\n\n  $scope.isDisabledAgg = function (agg) {\n    var invalidAggs = ['top_hits', 'percentiles', 'percentile_ranks', 'median', 'std_dev'];\n    return Boolean(invalidAggs.find(function (invalidAgg) {\n      return invalidAgg === agg.type.name;\n    }));\n  };\n\n  function checkBuckets() {\n    var lastBucket = _lodash2.default.findLast($scope.vis.getAggConfig(), function (agg) {\n      return agg.schema.group === 'buckets';\n    });\n    var bucketHasType = lastBucket && lastBucket.type;\n    var bucketIsHistogram = bucketHasType && ['date_histogram', 'histogram'].includes(lastBucket.type.name);\n    var canUseAggregation = lastBucket && bucketIsHistogram;\n\n    // remove errors on all buckets\n    _lodash2.default.each($scope.vis.aggs, function (agg) {\n      if (agg.error) delete agg.error;\n    });\n\n    if ($scope.aggForm.agg) {\n      $scope.aggForm.agg.$setValidity('bucket', canUseAggregation);\n    }\n    if (canUseAggregation) {\n      lastBucket.params.min_doc_count = lastBucket.type.name === 'histogram' ? 1 : 0;\n    } else {\n      if (lastBucket) {\n        var type = $scope.agg.type.title;\n        lastBucket.error = 'Last bucket aggregation must be \"Date Histogram\" or \\n        \"Histogram\" when using \"' + type + '\" metric aggregation!';\n      }\n    }\n  }\n\n  function updateOrderAgg() {\n    var agg = $scope.agg;\n    var params = agg.params;\n    var metricAgg = params.metricAgg;\n    var paramDef = agg.type.params.byName.customMetric;\n\n    checkBuckets();\n\n    // we aren't creating a custom aggConfig\n    if (metricAgg !== 'custom') {\n      if (!$scope.vis.getAggConfig().find(function (agg) {\n        return agg.id === metricAgg;\n      })) {\n        params.metricAgg = null;\n      }\n      params.customMetric = null;\n      return;\n    }\n\n    params.customMetric = params.customMetric || paramDef.makeAgg(agg);\n  }\n};\n\nexports.parentPipelineAggController = parentPipelineAggController;",null]}