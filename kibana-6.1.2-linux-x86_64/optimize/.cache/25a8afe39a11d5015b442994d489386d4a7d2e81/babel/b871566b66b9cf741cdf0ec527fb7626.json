{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/core_plugins/metrics/public/visualizations/components/timeseries.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/core_plugins/metrics/public/visualizations/components/timeseries.js","mtime":1515552030000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _get_last_value = require('../lib/get_last_value');\n\nvar _get_last_value2 = _interopRequireDefault(_get_last_value);\n\nvar _timeseries_chart = require('./timeseries_chart');\n\nvar _timeseries_chart2 = _interopRequireDefault(_timeseries_chart);\n\nvar _legend = require('./legend');\n\nvar _legend2 = _interopRequireDefault(_legend);\n\nvar _events = require('../lib/events');\n\nvar _events2 = _interopRequireDefault(_events);\n\nvar _reactcss = require('reactcss');\n\nvar _reactcss2 = _interopRequireDefault(_reactcss);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Timeseries = function (_Component) {\n  _inherits(Timeseries, _Component);\n\n  function Timeseries(props) {\n    _classCallCheck(this, Timeseries);\n\n    var _this = _possibleConstructorReturn(this, (Timeseries.__proto__ || Object.getPrototypeOf(Timeseries)).call(this, props));\n\n    var values = _this.getLastValues(props);\n    _this.state = {\n      showLegend: props.legend != null ? props.legend : true,\n      values: values || {},\n      show: _lodash2.default.keys(values) || [],\n      ignoreLegendUpdates: false,\n      ignoreVisabilityUpdates: false\n    };\n    _this.toggleFilter = _this.toggleFilter.bind(_this);\n    _this.handleHideClick = _this.handleHideClick.bind(_this);\n    _this.plothover = _this.plothover.bind(_this);\n    return _this;\n  }\n\n  _createClass(Timeseries, [{\n    key: 'filterLegend',\n    value: function filterLegend(id) {\n      if (!_lodash2.default.has(this.state.values, id)) return [];\n      var notAllShown = _lodash2.default.keys(this.state.values).length !== this.state.show.length;\n      var isCurrentlyShown = _lodash2.default.includes(this.state.show, id);\n      var show = [];\n      if (notAllShown && isCurrentlyShown) {\n        this.setState({ ignoreVisabilityUpdates: false, show: Object.keys(this.state.values) });\n      } else {\n        show.push(id);\n        this.setState({ ignoreVisabilityUpdates: true, show: [id] });\n      }\n      return show;\n    }\n  }, {\n    key: 'toggleFilter',\n    value: function toggleFilter(event, id) {\n      var show = this.filterLegend(id);\n      if (_lodash2.default.isFunction(this.props.onFilter)) {\n        this.props.onFilter(show);\n      }\n      _events2.default.trigger('toggleFilter', id, this);\n    }\n  }, {\n    key: 'getLastValues',\n    value: function getLastValues(props) {\n      var values = {};\n      props.series.forEach(function (row) {\n        // we need a valid identifier\n        if (!row.id) row.id = row.label;\n        values[row.id] = (0, _get_last_value2.default)(row.data);\n      });\n      return values;\n    }\n  }, {\n    key: 'updateLegend',\n    value: function updateLegend(pos, item) {\n      var values = {};\n      if (pos) {\n        this.props.series.forEach(function (row) {\n          if (row.data && Array.isArray(row.data)) {\n            if (item && row.data[item.dataIndex] && row.data[item.dataIndex][0] === item.datapoint[0]) {\n              values[row.id] = row.data[item.dataIndex][1];\n            } else {\n              var closest = void 0;\n              for (var i = 0; i < row.data.length; i++) {\n                closest = i;\n                if (row.data[i] && pos.x < row.data[i][0]) break;\n              }\n              if (!row.data[closest]) return values[row.id] = null;\n\n              var _row$data$closest = _slicedToArray(row.data[closest], 2),\n                  value = _row$data$closest[1];\n\n              values[row.id] = value != null && value || null;\n            }\n          }\n        });\n      } else {\n        _lodash2.default.assign(values, this.getLastValues(this.props));\n      }\n\n      this.setState({ values: values });\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(props) {\n      if (props.legend !== this.props.legend) this.setState({ showLegend: props.legend });\n      if (!this.state.ignoreLegendUpdates) {\n        var values = this.getLastValues(props);\n        var currentKeys = _lodash2.default.keys(this.state.values);\n        var keys = _lodash2.default.keys(values);\n        var diff = _lodash2.default.difference(keys, currentKeys);\n        var nextState = { values: values };\n        if (diff.length && !this.state.ignoreVisabilityUpdates) {\n          nextState.show = keys;\n        }\n        this.setState(nextState);\n      }\n    }\n  }, {\n    key: 'plothover',\n    value: function plothover(event, pos, item) {\n      this.updateLegend(pos, item);\n    }\n  }, {\n    key: 'handleHideClick',\n    value: function handleHideClick() {\n      this.setState({ showLegend: !this.state.showLegend });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var className = 'rhythm_chart';\n      if (this.props.reversed) {\n        className += ' reversed';\n      }\n      var styles = (0, _reactcss2.default)({\n        bottomLegend: {\n          content: {\n            flexDirection: 'column'\n          }\n        }\n      }, { bottomLegend: this.props.legendPosition === 'bottom' });\n      return _react2.default.createElement(\n        'div',\n        { className: className },\n        _react2.default.createElement(\n          'div',\n          { style: styles.content, className: 'rhythm_chart__content' },\n          _react2.default.createElement(\n            'div',\n            { className: 'rhythm_chart__visualization' },\n            _react2.default.createElement(_timeseries_chart2.default, {\n              dateFormat: this.props.dateFormat,\n              crosshair: this.props.crosshair,\n              onBrush: this.props.onBrush,\n              plothover: this.plothover,\n              reversed: this.props.reversed,\n              series: this.props.series,\n              annotations: this.props.annotations,\n              show: this.state.show,\n              showGrid: this.props.showGrid,\n              tickFormatter: this.props.tickFormatter,\n              options: this.props.options,\n              xaxisLabel: this.props.xaxisLabel,\n              yaxes: this.props.yaxes\n            })\n          ),\n          _react2.default.createElement(_legend2.default, {\n            legendPosition: this.props.legendPosition,\n            onClick: this.handleHideClick,\n            onToggle: this.toggleFilter,\n            series: this.props.series,\n            showLegend: this.state.showLegend,\n            seriesValues: this.state.values,\n            seriesFilter: this.state.show,\n            tickFormatter: this.props.tickFormatter\n          })\n        )\n      );\n    }\n  }]);\n\n  return Timeseries;\n}(_react.Component);\n\nTimeseries.defaultProps = {\n  legned: true,\n  showGrid: true\n};\n\nTimeseries.propTypes = {\n  legend: _propTypes2.default.bool,\n  legendPosition: _propTypes2.default.string,\n  onFilter: _propTypes2.default.func,\n  series: _propTypes2.default.array,\n  annotations: _propTypes2.default.array,\n  reversed: _propTypes2.default.bool,\n  options: _propTypes2.default.object,\n  tickFormatter: _propTypes2.default.func,\n  showGrid: _propTypes2.default.bool,\n  xaxisLabel: _propTypes2.default.string,\n  dateFormat: _propTypes2.default.string\n};\n\nexports.default = Timeseries;\nmodule.exports = exports['default'];",null]}