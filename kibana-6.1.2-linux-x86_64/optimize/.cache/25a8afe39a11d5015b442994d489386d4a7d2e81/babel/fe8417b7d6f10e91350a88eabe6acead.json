{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/ui/public/timepicker/timepicker.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/ui/public/timepicker/timepicker.js","mtime":1515552038000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nvar _timepicker = require('ui/timepicker/timepicker.html');\n\nvar _timepicker2 = _interopRequireDefault(_timepicker);\n\nrequire('./quick_panel');\n\nrequire('./relative_panel');\n\nrequire('./absolute_panel');\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _relative_options = require('./relative_options');\n\nvar _parse_relative_parts = require('./parse_relative_parts');\n\nvar _datemath = require('@elastic/datemath');\n\nvar _datemath2 = _interopRequireDefault(_datemath);\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _notifier = require('ui/notify/notifier');\n\nrequire('ui/timepicker/timepicker.less');\n\nrequire('ui/directives/input_datetime');\n\nrequire('ui/directives/inequality');\n\nrequire('ui/timepicker/quick_ranges');\n\nrequire('ui/timepicker/refresh_intervals');\n\nrequire('ui/timepicker/time_units');\n\nrequire('ui/timepicker/kbn_global_timepicker');\n\nvar _modules = require('ui/modules');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _module = _modules.uiModules.get('ui/timepicker');\nvar notify = new _notifier.Notifier({\n  location: 'timepicker'\n});\n\n_module.directive('kbnTimepicker', function (timeUnits, refreshIntervals) {\n  return {\n    restrict: 'E',\n    scope: {\n      from: '=',\n      to: '=',\n      mode: '=',\n      interval: '=',\n      activeTab: '=',\n      onFilterSelect: '&',\n      onIntervalSelect: '&'\n    },\n    template: _timepicker2.default,\n    controller: function controller($scope) {\n      $scope.format = 'MMMM Do YYYY, HH:mm:ss.SSS';\n      $scope.modes = ['quick', 'relative', 'absolute'];\n      $scope.activeTab = $scope.activeTab || 'filter';\n\n      if (_lodash2.default.isUndefined($scope.mode)) $scope.mode = 'quick';\n\n      $scope.refreshLists = (0, _lodash2.default)(refreshIntervals).groupBy('section').values().value();\n\n      $scope.relative = {\n        from: {\n          count: 1,\n          unit: 'm',\n          preview: undefined,\n          round: false\n        },\n        to: {\n          count: 0,\n          unit: 's',\n          preview: undefined,\n          round: false\n        }\n      };\n\n      $scope.absolute = {\n        from: (0, _moment2.default)(),\n        to: (0, _moment2.default)()\n      };\n\n      $scope.units = timeUnits;\n\n      $scope.relativeOptions = _relative_options.relativeOptions;\n\n      $scope.$watch('from', function (date) {\n        if (_moment2.default.isMoment(date) && $scope.mode === 'absolute') {\n          $scope.absolute.from = date;\n        }\n      });\n\n      $scope.$watch('to', function (date) {\n        if (_moment2.default.isMoment(date) && $scope.mode === 'absolute') {\n          $scope.absolute.to = date;\n        }\n      });\n\n      // If we always return a new object from the getters below (pickFromDate and pickToDate) we'll create an\n      // infinite digest loop, so we maintain these copies to return instead.\n      $scope.$watch('absolute.from', function (newDate) {\n        _lodash2.default.set($scope, 'browserAbsolute.from', new Date(newDate.year(), newDate.month(), newDate.date()));\n      });\n\n      $scope.$watch('absolute.to', function (newDate) {\n        _lodash2.default.set($scope, 'browserAbsolute.to', new Date(newDate.year(), newDate.month(), newDate.date()));\n      });\n\n      // The datepicker directive uses native Javascript Dates, ignoring moment's default timezone. This causes\n      // the datepicker and the text input above it to get out of sync if the user changed the `dateFormat:tz` config\n      // in advanced settings. The text input will show the date in the user selected timezone, the datepicker will\n      // show the date in the local browser timezone. Since we really just want a day, month, year from the datepicker\n      // instead of a moment in time, we grab those individual values from the native date.\n      $scope.pickFromDate = function (date) {\n        if (!date) return _lodash2.default.get($scope, 'browserAbsolute.from');\n\n        var defaultTimeZoneDate = (0, _moment2.default)({\n          year: date.getFullYear(),\n          month: date.getMonth(),\n          day: date.getDate(),\n          hour: 0,\n          minute: 0,\n          second: 0,\n          millisecond: 0\n        });\n        return $scope.absolute.from = defaultTimeZoneDate;\n      };\n\n      $scope.pickToDate = function (date) {\n        if (!date) return _lodash2.default.get($scope, 'browserAbsolute.to');\n\n        var defaultTimeZoneDate = (0, _moment2.default)({\n          year: date.getFullYear(),\n          month: date.getMonth(),\n          day: date.getDate(),\n          hour: 23,\n          minute: 59,\n          second: 59,\n          millisecond: 999\n        });\n        return $scope.absolute.to = defaultTimeZoneDate;\n      };\n\n      $scope.setMode = function (thisMode) {\n        switch (thisMode) {\n          case 'quick':\n            break;\n          case 'relative':\n            $scope.relative = (0, _parse_relative_parts.parseRelativeParts)($scope.from, $scope.to);\n            $scope.formatRelative('from');\n            $scope.formatRelative('to');\n            break;\n          case 'absolute':\n            $scope.absolute.from = _datemath2.default.parse($scope.from || (0, _moment2.default)().subtract(15, 'minutes'));\n            $scope.absolute.to = _datemath2.default.parse($scope.to || (0, _moment2.default)(), true);\n            break;\n        }\n\n        $scope.mode = thisMode;\n      };\n\n      $scope.setQuick = function (from, to) {\n        $scope.onFilterSelect({ from: from, to: to });\n      };\n\n      $scope.setToNow = function (key) {\n        $scope.absolute[key] = (0, _moment2.default)();\n      };\n\n      $scope.setRelativeToNow = function (key) {\n        $scope.relative[key].count = 0;\n        $scope.relative[key].round = false;\n        $scope.formatRelative(key);\n      };\n\n      $scope.checkRelative = function () {\n        if ($scope.relative.from.count != null && $scope.relative.to.count != null) {\n          var from = _datemath2.default.parse(getRelativeString('from'));\n          var to = _datemath2.default.parse(getRelativeString('to'), true);\n          if (to && from) return to.isBefore(from);\n          return true;\n        }\n      };\n\n      $scope.formatRelative = function (key) {\n        var relativeString = getRelativeString(key);\n        var parsed = _datemath2.default.parse(relativeString, key === 'to');\n        var preview = void 0;\n        if (relativeString === 'now') {\n          preview = 'Now';\n        } else {\n          preview = parsed ? parsed.format($scope.format) : undefined;\n        }\n        _lodash2.default.set($scope, 'relative.' + key + '.preview', preview);\n        return parsed;\n      };\n\n      $scope.applyRelative = function () {\n        $scope.onFilterSelect({\n          from: getRelativeString('from'),\n          to: getRelativeString('to')\n        });\n      };\n\n      function getRelativeString(key) {\n        var count = _lodash2.default.get($scope, 'relative.' + key + '.count', 0);\n        var round = _lodash2.default.get($scope, 'relative.' + key + '.round', false);\n        var matches = _lodash2.default.get($scope, 'relative.' + key + '.unit', 's').match(/([smhdwMy])(\\+)?/);\n        var unit = void 0;\n        var operator = '-';\n        if (matches && matches[1]) unit = matches[1];\n        if (matches && matches[2]) operator = matches[2];\n        if (count === 0 && !round) return 'now';\n        var result = 'now' + operator + count + unit;\n        result += round ? '/' + unit : '';\n        return result;\n      }\n\n      $scope.applyAbsolute = function () {\n        $scope.onFilterSelect({\n          from: (0, _moment2.default)($scope.absolute.from),\n          to: (0, _moment2.default)($scope.absolute.to)\n        });\n      };\n\n      $scope.setRefreshInterval = function (interval) {\n        interval = _lodash2.default.clone(interval || {});\n        notify.log('before: ' + interval.pause);\n        interval.pause = interval.pause == null || interval.pause === false ? false : true;\n\n        notify.log('after: ' + interval.pause);\n\n        $scope.onIntervalSelect({ interval: interval });\n      };\n\n      $scope.setMode($scope.mode);\n    }\n  };\n});",null]}