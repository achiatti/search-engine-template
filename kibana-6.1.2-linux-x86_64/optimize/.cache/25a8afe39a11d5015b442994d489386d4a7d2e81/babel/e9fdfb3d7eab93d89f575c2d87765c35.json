{"remainingRequest":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js??ref--6-1!/home/vagrant/projects/kibana/build/kibana/src/core_plugins/metrics/public/components/vis_types/top_n/vis.js","dependencies":[{"path":"/home/vagrant/projects/kibana/build/kibana/src/core_plugins/metrics/public/components/vis_types/top_n/vis.js","mtime":1515552030000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1493198456000},{"path":"/home/vagrant/projects/kibana/build/kibana/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _tick_formatter = require('../../lib/tick_formatter');\n\nvar _tick_formatter2 = _interopRequireDefault(_tick_formatter);\n\nvar _top_n = require('plugins/metrics/visualizations/components/top_n');\n\nvar _top_n2 = _interopRequireDefault(_top_n);\n\nvar _get_last_value = require('plugins/metrics/visualizations/lib/get_last_value');\n\nvar _get_last_value2 = _interopRequireDefault(_get_last_value);\n\nvar _color2 = require('color');\n\nvar _color3 = _interopRequireDefault(_color2);\n\nvar _replace_vars = require('../../lib/replace_vars');\n\nvar _replace_vars2 = _interopRequireDefault(_replace_vars);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _lodash = require('lodash');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar OPPERATORS = { gt: _lodash.gt, gte: _lodash.gte, lt: _lodash.lt, lte: _lodash.lte };\n\nfunction sortByDirection(data, direction, fn) {\n  if (direction === 'desc') {\n    return (0, _lodash.sortBy)(data, fn).reverse();\n  }\n  return (0, _lodash.sortBy)(data, fn);\n}\n\nfunction sortSeries(visData, model) {\n  var series = (0, _lodash.get)(visData, model.id + '.series', []);\n  return model.series.reduce(function (acc, item) {\n    var itemSeries = series.filter(function (s) {\n      var id = (0, _lodash.first)(s.id.split(/:/));\n      return id === item.id;\n    });\n    var direction = item.terms_direction || 'desc';\n    if (item.terms_order_by === '_term') return acc.concat(itemSeries);\n    return acc.concat(sortByDirection(itemSeries, direction, function (s) {\n      return (0, _get_last_value2.default)(s.data);\n    }));\n  }, []);\n}\n\nfunction TopNVisualization(props) {\n  var backgroundColor = props.backgroundColor,\n      model = props.model,\n      visData = props.visData;\n\n\n  var series = sortSeries(visData, model).map(function (item) {\n    var id = (0, _lodash.first)(item.id.split(/:/));\n    var seriesConfig = model.series.find(function (s) {\n      return s.id === id;\n    });\n    if (seriesConfig) {\n      var formatter = (0, _tick_formatter2.default)(seriesConfig.formatter, seriesConfig.value_template);\n      var value = (0, _get_last_value2.default)(item.data, item.data.length);\n      var _color = item.color || seriesConfig.color;\n      if (model.bar_color_rules) {\n        model.bar_color_rules.forEach(function (rule) {\n          if (rule.opperator && rule.value != null && rule.bar_color) {\n            if (OPPERATORS[rule.opperator](value, rule.value)) {\n              _color = rule.bar_color;\n            }\n          }\n        });\n      }\n      return _extends({}, item, {\n        color: _color,\n        tickFormatter: formatter\n      });\n    }\n    return item;\n  });\n\n  var params = {\n    series: series,\n    reversed: props.reversed\n  };\n  var panelBackgroundColor = model.background_color || backgroundColor;\n\n  if (panelBackgroundColor && panelBackgroundColor !== 'inherit') {\n    params.reversed = (0, _color3.default)(panelBackgroundColor).luminosity() < 0.45;\n  }\n\n  if (model.drilldown_url) {\n    params.onClick = function (item) {\n      window.location = (0, _replace_vars2.default)(model.drilldown_url, {}, { key: item.label });\n    };\n  }\n  var style = { backgroundColor: panelBackgroundColor };\n  return _react2.default.createElement(\n    'div',\n    { className: 'dashboard__visualization', style: style },\n    _react2.default.createElement(_top_n2.default, params)\n  );\n}\n\nTopNVisualization.propTypes = {\n  backgroundColor: _propTypes2.default.string,\n  className: _propTypes2.default.string,\n  model: _propTypes2.default.object,\n  onBrush: _propTypes2.default.func,\n  onChange: _propTypes2.default.func,\n  reversed: _propTypes2.default.bool,\n  visData: _propTypes2.default.object\n};\n\nexports.default = TopNVisualization;\nmodule.exports = exports['default'];",null]}